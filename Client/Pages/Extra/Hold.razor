@page "/profileeee/{id}"
@layout EmptyLayout
@inject NavigationManager NavManager
@inject HttpClient Http
@using TransGo_Alpha.Shared
@using TransGo_Alpha.Client.Components


@if (bub == null)
{
    <text>Loading...</text>
}
else
{
    <head>
        <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
    </head>
    <body>
        <div class="canvas">
            <div class="side-grid">
                <nav class="nav @(IsOpen ? "nav-closed" : "")">
                    <svg class="nav__expand" viewBox="0 0 256 512" width="100" title="angle-  right" @onclick="@OpenClose">
                        <path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z" />
                    </svg>
                    <ul class="nav__list">
                        <li class="nav__listitem">
                            <a href="#" class="nav__link">
                                <svg viewBox="0 0 384 512" width="100" title="file-alt">
                                    <path d="M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm64 236c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12v8zm0-64c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12v8zm0-72v8c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12zm96-114.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z" />
                                </svg>
                                <p>Transcope</p>
                            </a>
                        </li>
                        <li class="nav__listitem">
                            <a href="#">
                                <svg viewBox="0 0 544 512" width="100" title="chart-pie">
                                    <path d="M527.79 288H290.5l158.03 158.03c6.04 6.04 15.98 6.53 22.19.68 38.7-36.46 65.32-85.61 73.13-140.86 1.34-9.46-6.51-17.85-16.06-17.85zm-15.83-64.8C503.72 103.74 408.26 8.28 288.8.04 279.68-.59 272 7.1 272 16.24V240h223.77c9.14 0 16.82-7.68 16.19-16.8zM224 288V50.71c0-9.55-8.39-17.4-17.84-16.06C86.99 51.49-4.1 155.6.14 280.37 4.5 408.51 114.83 513.59 243.03 511.98c50.4-.63 96.97-16.87 135.26-44.03 7.9-5.6 8.42-17.23 1.57-24.08L224 288z" />
                                </svg>
                                <p>Analytics</p>
                            </a>
                        </li>
                        <li class="nav__listitem">
                            <a href="#">
                                <svg viewBox="0 0 512 512" width="100" title="chart-line">
                                    <path d="M496 384H64V80c0-8.84-7.16-16-16-16H16C7.16 64 0 71.16 0 80v336c0 17.67 14.33 32 32 32h464c8.84 0 16-7.16 16-16v-32c0-8.84-7.16-16-16-16zM464 96H345.94c-21.38 0-32.09 25.85-16.97 40.97l32.4 32.4L288 242.75l-73.37-73.37c-12.5-12.5-32.76-12.5-45.25 0l-68.69 68.69c-6.25 6.25-6.25 16.38 0 22.63l22.62 22.62c6.25 6.25 16.38 6.25 22.63 0L192 237.25l73.37 73.37c12.5 12.5 32.76 12.5 45.25 0l96-96 32.4 32.4c15.12 15.12 40.97 4.41 40.97-16.97V112c.01-8.84-7.15-16-15.99-16z" />
                                </svg>
                                <p>Trends</p>
                            </a>
                        </li>
                        <li class="nav__listitem">
                            <a href="#">
                                <svg viewBox="0 0 448 512" width="100" title="address-book">
                                    <path d="M436 160c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12h-20V48c0-26.5-21.5-48-48-48H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h320c26.5 0 48-21.5 48-48v-48h20c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12h-20v-64h20c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12h-20v-64h20zm-228-32c35.3 0 64 28.7 64 64s-28.7 64-64 64-64-28.7-64-64 28.7-64 64-64zm112 236.8c0 10.6-10 19.2-22.4 19.2H118.4C106 384 96 375.4 96 364.8v-19.2c0-31.8 30.1-57.6 67.2-57.6h5c12.3 5.1 25.7 8 39.8 8s27.6-2.9 39.8-8h5c37.1 0 67.2 25.8 67.2 57.6v19.2z" />
                                </svg>
                                <p>Account</p>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
            <div class="top-grid">
                <h1 class="toptext">Your Courses</h1>
                <div class="classterm">Fall 2020</div>
            </div>
            <div class="wrapper-grid">
                @if (bub != null)
                {
                    @foreach (Course cub in cube)
                    {
                        <div class="container">
                            <h1 class="name">@cub.CourseNum</h1>
                            <p class="description">@cub.CourseName</p>
                            <p class="transcript">2 Transcripts</p>
                        </div>
                    }
                }
                <a href="" @onclick="@AddCourseButton" @onclick:preventDefault>
                    <div class="newcoursebox">
                        <p class="newcourse">Add a course</p>
                    </div>
                </a>
            </div>
            <div class="footer-grid">
            </div>
        </div>


    </body>

}

<AddCourseIdDialog @ref="AddCourseIdDialog">

</AddCourseIdDialog>

@code {
    [Parameter]
    public string Id { get; set; }
    User profile { get; set; }
    private bool IsOpen { get; set; } = false;
    List<Course> cube = new List<Course>();
    Course bub { get; set; }
    private int[] _coursearray;

    protected async override Task OnParametersSetAsync()
    {
        ProcessCourses();
    }

    private void OpenClose()
    {
        IsOpen = !IsOpen;
    }

    private async void ProcessCourses()
    {
        profile = await Http.GetFromJsonAsync<User>($"api/users/profile/{Id}");
        if (profile.Coursecodes != null)
        {
            _coursearray = profile.Coursecodes.Split(' ').Select(Int32.Parse).ToArray();
            @foreach (var vab in _coursearray)
            {
                bub = await Http.GetFromJsonAsync<Course>($"api/courses/{vab}");
                cube.Add(bub);
            }
        }

    }

    public AddCourseIdDialog AddCourseIdDialog
    {
        get;
        set;
    }

    private void AddCourseButton()
    {
        AddCourseIdDialog.Show(profile);
    }

}
